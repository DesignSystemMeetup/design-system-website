!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.svg4everybody=b()}):"object"==typeof exports?module.exports=b():a.svg4everybody=b()}(this,function(){/*! svg4everybody v2.0.0 | github.com/jonathantneal/svg4everybody */
function a(a,b){if(b){var c=!a.getAttribute("viewBox")&&b.getAttribute("viewBox"),d=document.createDocumentFragment(),e=b.cloneNode(!0);for(c&&a.setAttribute("viewBox",c);e.childNodes.length;)d.appendChild(e.firstChild);a.appendChild(d)}}function b(b){b.onreadystatechange=function(){if(4===b.readyState){var c=document.createElement("x");c.innerHTML=b.responseText,b.s.splice(0).map(function(b){a(b[0],c.querySelector("#"+b[1].replace(/(\W)/g,"\\$1")))})}},b.onreadystatechange()}function c(c){function d(){for(var c;c=e[0];){var j=c.parentNode;if(j&&/svg/i.test(j.nodeName)){var k=c.getAttribute("xlink:href");if(f&&(!g||g(k,j,c))){var l=k.split("#"),m=l[0],n=l[1];if(j.removeChild(c),m.length){var o=i[m]=i[m]||new XMLHttpRequest;o.s||(o.s=[],o.open("GET",m),o.send()),o.s.push([j,n]),b(o)}else a(j,document.getElementById(n))}}}h(d,17)}c=c||{};var e=document.getElementsByTagName("use"),f="shim"in c?c.shim:/\bEdge\/12\b|\bTrident\/[567]\b|\bVersion\/7.0 Safari\b/.test(navigator.userAgent)||(navigator.userAgent.match(/AppleWebKit\/(\d+)/)||[])[1]<537,g=c.validate,h=window.requestAnimationFrame||setTimeout,i={};f&&d()}return c});
svg4everybody();

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-23571257-4');

// if('serviceWorker' in navigator) {
// 	navigator
// 		.serviceWorker
// 		.register('/sw.min.js')
// 		.catch( error => console.error( error ) );
// }

navigator.serviceWorker.getRegistrations().then(function(registrations) {
	for(var reg of registrations) {
		reg.unregister();
	}
});

var form = document.getElementById('join-form');
var attendees = document.getElementById('join-attendees');

function join(event) {
	event.preventDefault();
	var id = document.getElementById('join-form-id').value;
	var email = document.getElementById('join-form-email').value;
	var submit = document.getElementById('join-form-submit');

	submit.setAttribute('disabled', true);

	fetch(form.getAttribute('action'), {
		method: 'POST',
		redirect: 'manual',
		headers: {
			'Accept': 'application/json',
			'Content-Type': 'application/json'
		},
		body: JSON.stringify({
			id: id,
			email: email,
		}),
	})
	.then(function() {
		submit.removeAttribute('disabled');
		document.getElementById('join-form-email').value = "";
		show_attendees();
	}).catch(function() {});
}

function show_attendees() {
	fetch(attendees.getAttribute('data-get-data-from'), {
		method: 'GET',
		headers: {
			'Accept': 'application/json',
			'Content-Type': 'application/json'
		},
	})
	.then(function(response) {
		response.json().then(function(data) {
			var list = document.createElement("ul");
			list.setAttribute('class', 'join-attendees-list');
			data.forEach(function(person) {
				var person_wrapper = document.createElement("li");
				var person_image = document.createElement("img");
				person_image.setAttribute('src', 'https://www.gravatar.com/avatar/' + person.hash + '.jpg?s=100');
				person_image.setAttribute('title', person.email);
				person_wrapper.appendChild(person_image);
				list.appendChild(person_wrapper);
			});
			while(attendees.firstChild) {
				attendees.removeChild(attendees.firstChild);
			}
			attendees.appendChild(list);
			if (data.length > 0) {
				document.getElementById('join-attendees-wrapper').removeAttribute('data-hidden');
			}
			document.getElementById('join-attendees-heading').setAttribute('title', 'RSVPs: ' + data.length);
		});
	});
}

if (form) {
	form.addEventListener('submit', join);
}

if (attendees) {
	show_attendees();
}
